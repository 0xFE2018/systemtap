#! stap

global ar1, ar2

function string (v) { return "" } # to become built-in

function search (key) 
{
  if (key in ar1)
    { ar1[key] ++; return ar2[ar1[key]] }
  else
    return "no can do"
}

probe syscall("zamboni")
{
  thread->ar2 = $tgid;
  search ($pid)
}

probe end
{
  for (key in ar2)
  # if (key in ar2)
    printk ("this: " . string (key) . " was " . string (ar2[key]))
}
