/*
 * kfunct.stp
 *
 * Check the systemtap avoids infinite loops
 * install it, and get some output.
 */

global count
global loop_count

probe begin
{
	log("systemtap starting probe")
}

probe kernel.function("schedule")
{
	++count;
	for(a = 1; a <=10; ++a) {
		++loop_count;
	}
}

probe end
{
	log("systemtap ending probe")
	log("count = " . sprint(count));
	log("loop_count = " . sprint(loop_count));
	if ( count * 10 == loop_count) {
		log("systemtap test success");
	} else {
		log("systemtap test failure");
	}
}
