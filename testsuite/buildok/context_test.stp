#! stap -p4

function print_stuff () {
	print_regs()
	print_backtrace()
	bt = backtrace()
	print("the stack is " . bt)
	print("\n\n")
	print_stack(bt)
	print("\n\n")
	log("execname is \"" . execname() . "\"")
	log("pid is " . sprint(pid()))
	log("tid is " . sprint(tid()))
	log("pexecname is \"" . pexecname() . "\"")
	log("ppid is " . sprint(ppid()))
	log("uid is " . sprint(uid()))
	log("euid is " . sprint(euid()))
	log("gid is " . sprint(gid()))
	log("egid is " . sprint(egid()))
	log("pp is '" . pp() . "'")
}

probe kernel.function("uptime_read_proc") {
	print("NOW IN UPTIME\n")
	print_stuff ()
}

probe kernel.function("uptime_read_proc").return {
	print("DONE WITH UPTIME\n")
	print_stuff ()
	exit ()
}

probe begin {
	print ("BEGIN\n")
}

probe end {
	print ("END\n")
}
