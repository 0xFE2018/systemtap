#! stap -p4

function print_stuff () {
	print_regs()
	print_backtrace()
	bt = backtrace()
	print("the stack is " . bt)
	print("\n\n")
	print_stack(bt)
	print("\n\n")
	printf("execname is %s\n", execname())
	printf("pid is %d\n",pid())
	printf("tid is %d\n", tid())
	printf("pexecname is %s\n", pexecname())
	printf("ppid is %d\n", ppid())
	printf("uid is %d\n", uid())
	printf("euid is %d\n", euid())
	printf("gid is %d\n", gid())
	printf("egid is %d\n", egid())
	printf("pp is %s\n", pp())
}

probe kernel.function("uptime_read_proc") ? {
	print("NOW IN UPTIME\n")
	print_stuff ()
}

probe kernel.function("uptime_read_proc").return ? {
	print("DONE WITH UPTIME\n")
	print_stuff ()
	exit ()
}

probe begin {
	print ("BEGIN\n")
}

probe end {
	print ("END\n")
}
