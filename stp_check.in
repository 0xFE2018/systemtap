#!/bin/bash

# speed up grep and friends
LANG=C
export LANG

RELAYFS_FS=`grep relayfs_create_dir /proc/kallsyms`
RELAY=`grep relay_open /proc/kallsyms`
if [ -n "$RELAY" -a -z "$RELAYFS_FS" ]
then
	MOUNT=`mount | grep "/sys/kernel/debug" |awk '{print $1}'`
	if [ "$MOUNT" != "debugfs" ]
	then
		mount -t debugfs debugfs /sys/kernel/debug
	fi
	MOUNT=`mount | grep "/sys/kernel/debug" |awk '{print $1}'`
	if [ "$MOUNT" != "debugfs" ]
	then
		exit 1
	fi
	exit 0
fi

if [ ! -d "/mnt/relay" ]
then
    mkdir /mnt/relay
fi

MOUNT=`mount | grep "/mnt/relay" |awk '{print $1}'`
if [ "$MOUNT" != "relayfs" ]
then
	mount -t relayfs relayfs /mnt/relay
fi

RELAYFS_FS=`grep relayfs /proc/kallsyms`
if [ -z "$RELAYFS_FS" ]
then
	exit 1
fi
