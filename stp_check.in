#!/bin/bash

# speed up grep and friends
LANG=C
export LANG

RELAYFS_FS=`grep relayfs_create_dir /proc/kallsyms`
RELAY=`grep relay_open /proc/kallsyms`
if [ -n "$RELAY" -a -z "$RELAYFS_FS" ]
then
	MOUNT=`mount -t debugfs | grep "/sys/kernel/debug"`
	if [ "$MOUNT" == "" ]
	then
		mount -t debugfs debugfs /sys/kernel/debug
	fi
	MOUNT=`mount -t debugfs | grep "/sys/kernel/debug"`
	if [ "$MOUNT" == "" ]
	then
		exit 1
	fi
	exit 0
fi

if [ ! -d "/mnt/relay" ]
then
    mkdir /mnt/relay
fi

MOUNT=`mount -t relayfs | grep "/mnt/relay"`
if [ "$MOUNT" == "" ]
then
	mount -t relayfs relayfs /mnt/relay
fi

RELAYFS_FS=`grep relayfs /proc/kallsyms`
if [ -z "$RELAYFS_FS" ]
then
	exit 1
fi
